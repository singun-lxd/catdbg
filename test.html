<!DOCTYPE html>
<html lang="zh-CN">
    <head>
        <meta charset="UTF-8">
    </head>
    <body>
        <script src="https://code.jquery.com/jquery-3.7.1.min.js" ></script>
        <script src="https://cdn.jsdelivr.net/npm/crypto-js@4.0.0/crypto-js.js" ></script>
        <script src="./proxy.js"></script>
        <script src="./test.js"/></script>
        <script>
            const jsFunctions = __jsEvalReturn();
            const _cfg = {
                skey: 'test',
                stype: 'test',
            };
            const _tid = '20';
            let homeData = null;
            let videoId = null;
            let playUrl = null;
            async function _category(page) {
                const extend = JSON.parse(homeData).filters;
                return await jsFunctions.category(_tid, page, null, extend);
            }
            async function _detail(id) {
                return await jsFunctions.detail(id);
            }
            async function _play(id) {
                return await jsFunctions.play(null, id, null);
            }
            async function _search(wd) {
                return await jsFunctions.search(wd, false);
            }
            async function _main() {
                await jsFunctions.init(_cfg);
                homeData = await jsFunctions.home();
                const categoryStr = await _category(1);
                console.log(categoryStr);
                const categoryJson = JSON.parse(categoryStr);
                videoId = categoryJson.list[0].vod_id;
            }
            _main().then((data)=> {
                console.log("init home success");
            });
            function onClickPage2() {
                _category(2).then((data) => {
                    console.log(data);
                });
            }
            function onClickDetail() {
                _detail(videoId).then((data) => {
                    console.log(data);
                    const detailJson = JSON.parse(data);
                    const urlList = detailJson.list[0].vod_play_url;
                    playUrl = urlList.split('#')[0].split('$')[1];
                });
            }
            function onClickPlay() {
                _play(playUrl).then((data) => {
                    console.log(data);
                    $('#load_container').empty();
                    const playData = JSON.parse(data);
                    $('#video_player').attr('src', playData.url).show();
                });
            }
            function onClickSearch() {
                _search('狂飙').then((data) => {
                    console.log(data);
                });
            }
        </script>
        <div id="load_container" style="display:none"></div>
        <button onclick="onClickPage2()">Page2</button>
        <button onclick="onClickDetail()">Detail</button>
        <button onclick="onClickPlay()">Play</button>
        <button onclick="onClickSearch()">Search</button>
        <video id="video_player" width="320" height="240" autoplay="autoplay" controls="controls" style="display:none" src=""></video>
    </body>
</html>